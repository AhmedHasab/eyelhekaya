<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø°ÙƒØ§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚ØµØµ â€“ Ø¥ÙŠÙ‡ Ø§Ù„Ø­ÙƒØ§ÙŠØ©ØŸ</title>

  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="style.css" />

  <meta name="theme-color" content="#ffffff" />
  <link rel="icon" type="image/png" href="Logo_Channel.png">
  <link rel="apple-touch-icon" href="icon-192.png">
</head>

<body>
  <div class="app-container">

    <header class="app-header">
      <h1>ğŸ¬ Ø°ÙƒØ§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚ØµØµ â€“ Ù‚Ù†Ø§Ø© "Ø¥ÙŠÙ‡ Ø§Ù„Ø­ÙƒØ§ÙŠØ©ØŸ"</h1>

      <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ±Ù†Ø¯ -->
      <div class="top-buttons">
        <button id="btn-pick-today" class="btn primary strong">ğŸ—“ Ø§Ø®ØªÙŠØ§Ø± Ù‚ØµØ© ÙÙŠØ¯ÙŠÙˆ Ø·ÙˆÙŠÙ„ ÙˆÙÙ‚Ø§ Ù„Ù„ØªØ±Ù†Ø¯</button>
        <button id="btn-pick-long" class="btn primary">ğŸ¥ Ø§Ø®ØªÙŠØ§Ø± Ù‚ØµØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù…Ø³Ø¬Ù„Ø© Ø¨Ø§Ù„Ù…ÙˆÙ‚Ø¹ (ÙÙŠØ¯ÙŠÙˆ Ø·ÙˆÙŠÙ„)</button>
        <button id="btn-pick-short" class="btn accent">âš¡ Ø§Ø®ØªÙŠØ§Ø± ÙÙŠØ¯ÙŠÙˆ (Ø±ÙŠÙ„Ø²) Ù…Ù† Ø§Ù„ØªØ±Ù†Ø¯</button>
        <button id="btn-update-trends" class="btn secondary">ğŸ“ˆ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ±ÙŠÙ†Ø¯Ø§Øª</button>
      </div><!-- âœ… top-buttons CLOSED -->

      <!-- Ø­Ø§Ù„Ø© Ø§Ù„ØªØ±ÙŠÙ†Ø¯ -->
      <div class="status-row">
        <span id="status-trends" class="status-pill muted">ØªØ±ÙŠÙ†Ø¯Ø§Øª Google ØºÙŠØ± Ù…Ø­Ø¯Ø«Ø©</span>
        <span id="status-youtube" class="status-pill muted">ØªØ±ÙŠÙ†Ø¯Ø§Øª YouTube ØºÙŠØ± Ù…Ø­Ø¯Ø«Ø©</span>
        <span id="status-deaths" class="status-pill muted">ÙˆÙÙŠØ§Øª Ø¢Ø®Ø± 48 Ø³Ø§Ø¹Ø© ØºÙŠØ± Ù…Ø­Ø¯Ø«Ø©</span>
      </div>

      <!-- Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ù„ÙˆØ­ÙŠÙ† -->
      <div class="layout-controls">
        <button id="btn-show-ai-only" class="btn secondary small">â¡ Ø¹Ø±Ø¶ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ ÙÙ‚Ø·</button>
        <button id="btn-show-both" class="btn secondary small">â¬Œ Ø¹Ø±Ø¶ Ø§Ù„Ù„ÙˆØ­ÙŠÙ† Ù…Ø¹Ù‹Ø§</button>
        <button id="btn-show-stories-only" class="btn secondary small">â¬… Ø¹Ø±Ø¶ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ØµØµ ÙÙ‚Ø·</button>
      </div>
    </header>

    <main class="main-layout">

      <!-- Ù„ÙˆØ­Ø© Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ -->
      <section class="ai-panel card">
        <h2>ğŸ§  Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h2>
        <div id="ai-output" class="ai-output">
          <p>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£Ø­Ø¯ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„.</p>
        </div>
      </section>

      <!-- Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ØµØµ -->
      <section class="stories-panel card">
        <h2>ğŸ“š Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ØµØµ</h2>

        <!-- âœ… Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ / Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ (Sticky) -->
        <div id="edit-form-container">

          <!-- Ø¨Ø§Ù†Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ -->
          <div id="edit-banner" class="edit-banner hidden">
            âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ù‚ØµØ©: <span id="edit-banner-title"></span>
          </div>

          <textarea id="raw-input" rows="5" placeholder="Ù…Ø«Ø§Ù„:
Ù„ÙŠÙ„Ù‰ Ù…Ø±Ø§Ø¯
Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§ØºØªÙŠØ§Ù„ Ù…Ø¨Ø§Ø±Ùƒ
Ø­Ø§Ø¯Ø«Ø© Ø·Ø§Ø¦Ø±Ø© Ù…ØµØ± Ù„Ù„Ø·ÙŠØ±Ø§Ù†
..."></textarea><br>

          <label class="block-label">âœ‚ï¸ Ø§Ù„ØµÙ‚ Ø§Ù„Ù†Øµ Ø§Ù„Ø®Ø§Ù… Ù„Ù„Ù‚ØµØµ (ÙƒÙ„ Ø³Ø·Ø± = Ù‚ØµØ©):</label><br>

          <button id="btn-parse-raw" class="btn primary small">â• ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ Ù‚ØµØµ</button>

          <!-- Ø¥Ø¯Ø®Ø§Ù„ ÙŠØ¯ÙˆÙŠ ÙƒØ§Ù…Ù„ -->
          <div class="manual-input-row">

            <div class="manual-cell">
              <label>Ø§Ø³Ù… Ø§Ù„Ù‚ØµØ©</label>
              <textarea id="manual-name" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù‚ØµØ© Ù‡Ù†Ø§" rows="2" class="resizable-textarea"></textarea>
            </div>

            <div class="manual-cell">
              <label>Ù†ÙˆØ¹ Ø§Ù„Ù‚ØµØ© (Category)</label>

              <button type="button" id="toggle-categories" class="dropdown-btn">
                Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø§Øª â–¼
              </button>

              <div id="categories-dropdown" class="categories-dropdown hidden">
                <label><input type="checkbox" value="A">A- Ø§Ù„Ù…Ø´Ø§Ù‡ÙŠØ± ÙˆØ§Ù„Ù†Ø¬ÙˆÙ…</label>
                <label><input type="checkbox" value="B">B- Ø§Ù„Ø³ÙŠØ§Ø³ÙŠÙŠÙ† ÙˆØ§Ù„Ø²Ø¹Ù…Ø§Ø¡ ÙˆØ§Ù„Ù‚Ø§Ø¯Ø©</label>
                <label><input type="checkbox" value="C">C- Ø§Ù„Ù…Ø®Ø§Ø¨Ø±Ø§Øª ÙˆØ§Ù„Ø¬ÙˆØ§Ø³ÙŠØ³</label>
                <label><input type="checkbox" value="D">D- Ø§Ù„Ø¬Ø±Ø§Ø¦Ù… ÙˆØ§Ù„Ø§Ø®ØªÙØ§Ø¡Ø§Øª</label>
                <label><input type="checkbox" value="E">E- Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ</label>
                <label><input type="checkbox" value="F">F- Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡ ÙˆØ§Ù„ØµØ­Ø§Ø¨Ø© ÙˆØ§Ù„ØºØ²ÙˆØ§Øª</label>
                <label><input type="checkbox" value="G">G- Ø§Ù„Ø¹Ù„Ù…Ø§Ø¡ ÙˆØ§Ù„Ù…ÙÙƒØ±ÙŠÙ†</label>
              </div>

              <small style="opacity:.7">Ø§Ø®ØªØ± ÙØ¦Ø© ÙˆØ§Ø­Ø¯Ø© Ø£Ùˆ Ø£ÙƒØ«Ø±</small>
            </div>

            <div class="manual-cell">
              <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</label>

              <label>
                <input type="radio" name="story-type" value="long" checked>
                ğŸ¬ Ù‚ØµØ© Ø·ÙˆÙŠÙ„Ø©
              </label>

              <label>
                <input type="radio" name="story-type" value="short">
                âš¡ Ù‚ØµØ© Ù‚ØµÙŠØ±Ø© (Ø±ÙŠÙ„Ø²)
              </label>
            </div>

            <div class="manual-cell">
              <label>ØªÙ‚ÙŠÙŠÙ…Ùƒ Ø§Ù„Ø´Ø®ØµÙŠ (Ø§Ù„Ø¯Ø±Ø¬Ø©)</label>
              <input id="manual-score" type="number" min="0" max="100" value="80" />
            </div>

            <div class="manual-cell">
              <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª / Ø±ÙˆØ§Ø¨Ø·</label>
              <textarea id="manual-notes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø© â€“ Ø±Ø§Ø¨Ø· â€“ ÙƒÙ„Ù…Ø© Ù…ÙØªØ§Ø­ÙŠØ©" rows="4"
                class="resizable-textarea"></textarea>
            </div>

            <div class="manual-cell manual-cell-action">
              <label>&nbsp;</label>
              <button id="btn-add-manual" class="btn primary small">â• Ø¥Ø¶Ø§ÙØ© Ù‚ØµØ© ÙŠØ¯ÙˆÙŠÙ‹Ø§</button>
            </div>
          </div>

          <p class="manual-hint">âš™ ÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ¯Ø±Ø¬Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</p>

          <!-- ØªØµØ¯ÙŠØ± ÙˆØ§Ø³ØªÙŠØ±Ø§Ø¯ -->
          <div class="backup-row">
            <button id="btn-export" class="btn secondary small">ğŸ’¾ ØªØµØ¯ÙŠØ± Ø§Ù„Ù‚ØµØµ</button>

            <label for="import-file" class="btn secondary small file-label">ğŸ“‚ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù‚ØµØµ</label>
            <input type="file" id="import-file" hidden accept="application/json" />
          </div>

          <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« -->
          <div class="search-row">
            <label>ğŸ” Ø´Ø±ÙŠØ· Ø¨Ø­Ø«:</label>
            <textarea id="stories-search" placeholder="Ø§ÙƒØªØ¨ Ù„Ù„Ø¨Ø­Ø« ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ØµØµâ€¦" rows="2"
              class="resizable-textarea"></textarea>
          </div>

          <!-- Ø²Ø± Ø§Ù„Ù…ÙØ¶Ù„Ø© -->
          <button id="btn-show-favorites" class="btn secondary small">â­ Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙØ¶Ù„Ø©</button>

          <button id="btn-force-group" class="btn secondary" type="button">ğŸ§© ØªØ¬Ù…ÙŠØ¹ Ù…ØªØ´Ø§Ø¨Ù‡ (Ù…Ø¤Ù‚Øª)</button>

          <button id="btn-scan-duplicates" class="btn secondary small danger-outline" type="button">
            ğŸ” ÙØ­Øµ Ø§Ù„ØªÙƒØ±Ø§Ø±
          </button>

        </div><!-- âœ… edit-form-container CLOSED in the correct place -->

        <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù‚ØµØµ -->
        <div class="table-wrapper">
          <table id="stories-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Ø§Ù„Ø§Ø³Ù…</th>
                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                <th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                <th>Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ©</th>
                <th>Ø°ÙƒØ§Ø¡</th>
                <th>ØªÙ†ÙÙŠØ°</th>
                <th>ØªØ§Ø±ÙŠØ®</th>
                <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                <th>ØªØ­ÙƒÙ…</th>
              </tr>
            </thead>
            <tbody id="stories-tbody"></tbody>
          </table>
        </div>

        <!-- ========================= -->
        <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù‚ØµØµ Ø§Ù„Ù‚ØµÙŠØ±Ø© (Ø±ÙŠÙ„Ø²) -->
        <!-- ========================= -->
        <h3 style="margin-top:25px;">âš¡ Ø§Ù„Ù‚ØµØµ Ø§Ù„Ù‚ØµÙŠØ±Ø© (Ø±ÙŠÙ„Ø²)</h3>

        <div class="table-wrapper">
          <table id="short-stories-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Ø§Ù„Ø§Ø³Ù…</th>
                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                <th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                <th>Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ©</th>
                <th>Ø°ÙƒØ§Ø¡</th>
                <th>ØªÙ†ÙÙŠØ°</th>
                <th>ØªØ§Ø±ÙŠØ®</th>
                <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                <th>ØªØ­ÙƒÙ…</th>
              </tr>
            </thead>
            <tbody id="short-stories-tbody">
              <!-- ÙŠØªÙ… Ø§Ù„Ù…Ù„Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† app.js -->
            </tbody>
          </table>
        </div>

      </section>
    </main>

  </div><!-- âœ… app-container CLOSED -->


  <!-- ===============================
     SIMPLE PASSWORD GATE (24H)
     =============================== -->
  <script>
    (function () {
      const SITE_PASSWORD_HASH =
        "dd6cee257e7d07b78a5cb40b20969a4f66d04d8317920e469e9316702a47cb33";

      const STORAGE_KEY = "EH_AUTH_OK_UNTIL";
      const NOW = Date.now();
      const DAY_24H = 24 * 60 * 60 * 1000;

      const validUntil = Number(localStorage.getItem(STORAGE_KEY) || 0);
      if (validUntil > NOW) {
        console.log("ğŸ”“ Access granted (cached)");
        return;
      }

      document.documentElement.innerHTML = `
    <style>
      body {
        margin: 0;
        font-family: system-ui, sans-serif;
        background: #0f172a;
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100vh;
      }
      .gate {
        background: #020617;
        padding: 24px 28px;
        border-radius: 10px;
        box-shadow: 0 10px 40px rgba(0,0,0,.6);
        width: 320px;
        text-align: center;
      }
      .gate h2 { margin: 0 0 10px; }
      .gate input {
        width: 100%;
        padding: 10px;
        border-radius: 6px;
        border: none;
        margin-top: 10px;
        font-size: 15px;
      }
      .gate button {
        margin-top: 14px;
        width: 100%;
        padding: 10px;
        border-radius: 6px;
        border: none;
        background: #2563eb;
        color: #fff;
        font-size: 15px;
        cursor: pointer;
      }
      .err {
        margin-top: 10px;
        color: #f87171;
        font-size: 14px;
        display: none;
      }
    </style>

    <div class="gate">
      <h2>ğŸ” Ø¯Ø®ÙˆÙ„ Ø®Ø§Øµ</h2>
      <p>Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</p>
      <input type="password" id="pw" placeholder="Password" />
      <button id="btn">Ø¯Ø®ÙˆÙ„</button>
      <div class="err" id="err">âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©</div>
    </div>
  `;

      async function sha256(text) {
        const enc = new TextEncoder().encode(text);
        const buf = await crypto.subtle.digest("SHA-256", enc);
        return Array.from(new Uint8Array(buf))
          .map(b => b.toString(16).padStart(2, "0"))
          .join("");
      }

      document.getElementById("btn").onclick = async () => {
        const input = document.getElementById("pw").value.trim();
        if (!input) return;

        const hash = await sha256(input);

        if (hash === SITE_PASSWORD_HASH) {
          localStorage.setItem(STORAGE_KEY, String(Date.now() + DAY_24H));
          location.reload();
        } else {
          document.getElementById("err").style.display = "block";
        }
      };
    })();
  </script>

  <script>
    async function toggleFavorite(id) {
      const res = await postToWorker({
        action: "add_favorite",
        payload: { id }
      });

      if (!res.ok) return;

      FAVORITE_IDS = res.ids;
      renderAllTables();
    }

    function getSelectedStoryType() {
      const el = document.querySelector("input[name='story-type']:checked");
      return el ? el.value : "long";
    }

    function setCategoriesSelection(categories = []) {
      document
        .querySelectorAll("#categories-dropdown input[type='checkbox']")
        .forEach(cb => {
          cb.checked = categories.includes(cb.value);
        });
    }

    function clearCategoriesSelection() {
      document
        .querySelectorAll("#categories-dropdown input[type='checkbox']")
        .forEach(cb => {
          cb.checked = false;
        });
    }
  </script>

  <script>
    document.getElementById("toggle-categories")?.addEventListener("click", () => {
      document.getElementById("categories-dropdown").classList.toggle("hidden");
    });

    function getSelectedCategories() {
      return Array.from(
        document.querySelectorAll("#categories-dropdown input[type='checkbox']:checked")
      ).map(cb => cb.value);
    }
  </script>

  <script src="app.js"></script>

  <script>
    (function () {
      console.log("â›” Cache Override Activated (AI Cache Disabled)");

      window.getCachedAi = function () {
        console.log("Cache read blocked");
        return null;
      };

      window.setCachedAi = function () {
        console.log("Cache write blocked");
      };
    })();
  </script>

  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js");
    }
  </script>

  <style>
    .manual-input-row {
      display: grid;
      grid-template-columns: 2fr 1.2fr 0.6fr 2fr auto;
      gap: 12px;
      align-items: center;
      margin-bottom: 15px;
    }

    .manual-cell {
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .table-wrapper {
      display: inline-block;
      resize: both;
      overflow: auto;

      min-width: 900px;
      min-height: 500px;

      width: auto;
      height: auto;

      max-width: 1000px;
      max-height: 750px;

      box-sizing: border-box;
    }

    .resizable-textarea {
      width: 100%;
      resize: vertical;
      min-height: 42px;
      padding: 8px 10px;
      font-family: inherit;
      font-size: 14px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    #manual-notes {
      min-height: 80px;
    }

    .search-row {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 10px;
      align-items: center;
      margin: 15px 0;
    }

    #stories-search {
      max-width: 480px;
    }

    .dropdown-btn {
      padding: 6px 12px;
      cursor: pointer;
      border: 1px solid #ccc;
      background: #f7f7f7;
      border-radius: 4px;
    }

    .btn.danger-outline {
      border: 1px solid #f59e0b;
      background: #fff7ed;
      color: #92400e;
      font-weight: 800;
    }

    .btn.danger-outline:hover {
      background: #ffedd5;
      border-color: #d97706;
    }

    .btn.danger-outline:active {
      transform: scale(0.97);
    }

    .table-toolbar {
      margin-bottom: 8px;
      display: flex;
      justify-content: flex-start;
    }

    .categories-dropdown {
      margin-top: 6px;
      padding: 10px;
      border: 1px solid #ccc;
      background: #fff;
      max-width: 320px;
    }

    .categories-dropdown label {
      display: block;
      margin: 6px 0;
      cursor: pointer;
    }

    .hidden {
      display: none;
    }

    #edit-form-container {
      position: sticky;
      top: 0;
      z-index: 1000;

      background: #ffffff;
      padding: 12px 10px;
      border-bottom: 2px solid #f59e0b;

      transition: box-shadow 0.2s ease;
    }

    #edit-form-container.editing {
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    }

    .edit-banner {
      background: #fff3cd;
      border-bottom: 2px solid #f59e0b;
      padding: 10px 14px;
      font-weight: 700;
    }
  </style>

</body>
</html>
